-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.admin_users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  email text NOT NULL UNIQUE,
  password_hash text NOT NULL,
  role text NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT admin_users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ai_generated_images (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  post_id uuid,
  image_urls ARRAY,
  prompt_used text,
  selected_image_url text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_generated_images_pkey PRIMARY KEY (id),
  CONSTRAINT ai_generated_images_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.blog_posts(id)
);
CREATE TABLE public.blog_posts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  title text NOT NULL,
  content text NOT NULL,
  status text NOT NULL,
  scheduled_time timestamp with time zone,
  published_time timestamp with time zone,
  word_count integer,
  used_keywords ARRAY,
  used_trends ARRAY,
  image_urls ARRAY,
  tags ARRAY,
  internal_links jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  tone text,
  wordpress_url text,
  topic text,
  wordpress_post_id integer,
  blog_objective text,
  website_analysis_url text,
  error_acknowledged boolean NOT NULL DEFAULT false,
  error_acknowledged_at timestamp with time zone,
  CONSTRAINT blog_posts_pkey PRIMARY KEY (id),
  CONSTRAINT blog_posts_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.blog_settings (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  writing_style text NOT NULL,
  main_theme text NOT NULL,
  sub_theme text,
  other_theme text,
  theme_ratio text DEFAULT '3:1:1'::text,
  keywords ARRAY,
  template_type text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  wordpress_site_url text,
  wordpress_username text,
  wordpress_app_password text,
  wordpress_api_enabled boolean DEFAULT false,
  blog_console_url text,
  blog_username text,
  blog_password text,
  jetpack_stats_enabled boolean DEFAULT true,
  custom_blog_page_url text,
  use_custom_blog_url boolean DEFAULT false,
  password_only_mode boolean DEFAULT false,
  blog_publishing_url text,
  company_name text,
  auto_publish_facebook boolean DEFAULT false,
  auto_publish_google boolean DEFAULT false,
  CONSTRAINT blog_settings_pkey PRIMARY KEY (id),
  CONSTRAINT blog_settings_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.clients (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name text NOT NULL,
  contact_person text,
  email text NOT NULL UNIQUE,
  status text DEFAULT 'pending'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  license_type text,
  is_active boolean DEFAULT true,
  contract_end_date timestamp with time zone,
  password text,
  blog_creation_limit_per_week integer NOT NULL DEFAULT 2,
  image_generation_enabled boolean DEFAULT true,
  facebook_cred_id text,
  google_cred_id text,
  facebook_page_id text,
  google_location_id text,
  google_refresh_token text,
  fb_page_token text,
  is_admin boolean DEFAULT false,
  fb_page_id text,
  CONSTRAINT clients_pkey PRIMARY KEY (id)
);
CREATE TABLE public.daily_analytics (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  date date NOT NULL,
  total_views integer DEFAULT 0,
  unique_visitors integer DEFAULT 0,
  page_views integer DEFAULT 0,
  bounce_rate numeric DEFAULT 0,
  avg_session_duration numeric DEFAULT 0,
  engagement_rate numeric DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT daily_analytics_pkey PRIMARY KEY (id),
  CONSTRAINT daily_analytics_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.google_trends (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  keyword text,
  source text,
  run_ts timestamp with time zone,
  CONSTRAINT google_trends_pkey PRIMARY KEY (id)
);
CREATE TABLE public.post_analytics (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  post_id uuid,
  page_views integer DEFAULT 0,
  avg_time_on_page double precision,
  bounce_rate double precision,
  completion_rate double precision,
  social_shares integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_analytics_pkey PRIMARY KEY (id),
  CONSTRAINT post_analytics_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.blog_posts(id)
);
CREATE TABLE public.post_highlights (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  post_id uuid,
  client_id uuid,
  created_by text,
  block_type text,
  block_index integer,
  selected_text text,
  note text,
  created_at timestamp with time zone DEFAULT now(),
  start_offset integer,
  end_offset integer,
  CONSTRAINT post_highlights_pkey PRIMARY KEY (id),
  CONSTRAINT post_highlights_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.blog_posts(id),
  CONSTRAINT post_highlights_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.post_performance (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  post_id uuid UNIQUE,
  client_id uuid,
  title text NOT NULL,
  views integer DEFAULT 0,
  unique_views integer DEFAULT 0,
  avg_time_on_page numeric DEFAULT 0,
  bounce_rate numeric DEFAULT 0,
  social_shares integer DEFAULT 0,
  engagement_score numeric DEFAULT 0,
  ranking_position integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_performance_pkey PRIMARY KEY (id),
  CONSTRAINT post_performance_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.blog_posts(id),
  CONSTRAINT post_performance_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.posting_schedules (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  day_of_week integer CHECK (day_of_week IS NULL OR day_of_week >= 0 AND day_of_week <= 6),
  posting_time time without time zone,
  is_active boolean DEFAULT true,
  trend_source text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  tone text,
  keywords text,
  use_trends boolean DEFAULT true,
  use_images boolean DEFAULT true,
  publish_action text DEFAULT 'direct'::text,
  title text,
  min_char_count integer DEFAULT 500,
  max_char_count integer DEFAULT 3000,
  blog_structure text DEFAULT 'standard'::text,
  like_your_website_url text,
  is_recurring boolean DEFAULT true,
  scheduled_date timestamp with time zone,
  image_days ARRAY,
  page_url_1 text,
  page_url_2 text,
  page_url_3 text,
  page_url_4 text,
  page_url_5 text,
  company_website_url text,
  image_style text DEFAULT 'professional'::text,
  image_source text DEFAULT 'generate'::text CHECK (image_source = ANY (ARRAY['generate'::text, 'user_images'::text])),
  use_random_tone boolean DEFAULT false,
  wordpress_status character varying DEFAULT 'publish'::character varying CHECK (wordpress_status::text = ANY (ARRAY['publish'::character varying, 'draft'::character varying]::text[])),
  day_specific_settings jsonb DEFAULT '{}'::jsonb,
  blog_objective text DEFAULT 'SEO'::text CHECK (blog_objective = ANY (ARRAY['集客'::text, '求人'::text, 'PR'::text, 'SEO'::text])),
  content_weight_ratio jsonb DEFAULT '{"topic": 60, "company": 20, "keywords": 20}'::jsonb,
  wordpress_site_url text,
  wordpress_username text,
  wordpress_app_password text,
  wordpress_api_enabled boolean DEFAULT false,
  blog_console_url text,
  blog_username text,
  blog_password text,
  password_only_mode boolean DEFAULT false,
  custom_blog_page_url text,
  use_custom_blog_url boolean DEFAULT false,
  company_name text,
  company_analysis_focus text,
  blog_publishing_url text,
  CONSTRAINT posting_schedules_pkey PRIMARY KEY (id),
  CONSTRAINT posting_schedules_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.registration_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  token text NOT NULL UNIQUE,
  expires_at timestamp with time zone NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  used_at timestamp with time zone,
  CONSTRAINT registration_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT registration_tokens_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.social_media_accounts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  platform text NOT NULL,
  access_token text,
  refresh_token text,
  token_expires_at timestamp with time zone,
  platform_user_id text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT social_media_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT social_media_accounts_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.traffic_sources (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  client_id uuid,
  date date NOT NULL,
  source_name text NOT NULL,
  visits integer DEFAULT 0,
  percentage numeric DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT traffic_sources_pkey PRIMARY KEY (id),
  CONSTRAINT traffic_sources_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.trend_cache (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  source text NOT NULL,
  trends jsonb NOT NULL,
  cached_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone NOT NULL,
  CONSTRAINT trend_cache_pkey PRIMARY KEY (id)
);
CREATE TABLE public.twitter_trends (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  keyword text,
  source text,
  run_ts timestamp with time zone,
  CONSTRAINT twitter_trends_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_dashboard_state (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  client_id uuid NOT NULL UNIQUE,
  last_seen_errors_at timestamp with time zone NOT NULL DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_dashboard_state_pkey PRIMARY KEY (id),
  CONSTRAINT user_dashboard_state_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.user_images (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  client_id uuid NOT NULL,
  image_url text NOT NULL,
  original_filename text,
  file_size integer,
  mime_type text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_images_pkey PRIMARY KEY (id),
  CONSTRAINT user_images_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);